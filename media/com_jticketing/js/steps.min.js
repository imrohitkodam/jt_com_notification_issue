/**
 * @package     JTicketing
 *
 * @author      Techjoomla <extensions@techjoomla.com>
 * @copyright   Copyright (C) 2009 - 2025 Techjoomla. All rights reserved.
 * @license     GNU General Public License version 2 or later; see LICENSE.txt
 * unified Ajax request handler which will work like a entry point for all ajax call generated from the JTicketing component
 */
if(void 0===JTicketing)var JTicketing={};!function(e){e(document).ready((function(){e(document).on("change","#ticketsTypes",(function(){var t=e(this),o=e(".js-jt-ticket-listing");o.addClass("isloading"),JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"order.addItem",orderId:parseInt(t.data("order-id")),typeId:parseInt(this.value),view:"order"}}).done((function(t){!0===t.success?(o.empty(),o.html(t.data),o.trigger("subform-row-add",e(".js-jt-ticket-listing"))):Joomla.renderMessages({error:[t.message]})})).fail((function(e){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]})})).always((function(){o.removeClass("isloading"),e("#ticketsTypes").chosen()}))}))})),e(document).on("click",".proceedCheckout",(function(t){var o=e(this),a=parseInt(o.data("order-id"));JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"order.proceedToCheckout",orderId:a}}).done((function(e){!0===e.success?(1===ga_ec_analytics&&jtSite.order.addEcTrackingData(a,2),window.parent.location=e.data):Joomla.renderMessages({error:[e.message]})})).fail((function(e){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]})}))})),e(document).on("click",".attendeeCheckout",(function(t){var o=document.attendee_field_form,a=e(this),n=parseInt(a.data("order-id")),r=e("#attendeeCheckout");if(!document.formvalidator.isValid(o))return e("html, body").animate({scrollTop:0},"slow"),t.preventDefault();e(".alert-error").hide();var s=e("#attendee_field_form").serialize();s+="&orderId="+n,JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"order.addAttendee",orderId:n,attendee_field:s},beforeSend:function(){r.attr("disabled",!0),r.addClass("btn-loading")}}).done((function(t){r.attr("disabled",!1),!1===t.success?(Joomla.renderMessages({error:[t.message]}),e("html, body").animate({scrollTop:0},"slow")):(1===ga_ec_analytics&&jtSite.order.addEcTrackingData(n,3),window.location.href=t.data),r.removeClass("btn-loading")})).fail((function(e){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]})}))})),e(document).on("click",".removeItem",(function(){var t=e(this),o=parseInt(t.data("ticket-type-id")),a=parseInt(e(".ticketInput"+o).val()),n=e(".js-jt-ticket-listing"),r=" ";if(document.getElementById("coupon_code")&&(r=document.getElementById("coupon_code").value),n.addClass("isloading"),0==a)return n.removeClass("isloading"),void e("#ticketsTypes").chosen();a=--a,e(".ticketInput"+o).val(a),JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"order.removeItem",orderId:parseInt(t.data("order-id")),typeId:o,couponCode:r,view:"order"}}).done((function(t){!0===t.success?(n.empty(),n.html(t.data)):(e(".ticketInput"+o).val(++a),Joomla.renderMessages({error:[t.message]}))})).fail((function(t){e(".ticketInput"+o).val(++a),Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]})})).always((function(){n.removeClass("isloading"),e("#ticketsTypes").chosen()}))})),e(document).on("click",".addItem",(function(){var t=e(this),o=parseInt(t.data("checkout-limit")),a=parseInt(t.data("unlimited-ticket")),n=parseInt(t.data("ticket-type-id")),r=parseInt(e(".ticketInput"+n).val()),s=e(".js-jt-ticket-listing");if(s.addClass("isloading"),r>=o&&!a)return Joomla.renderMessages({error:[Joomla.JText._("JT_PERUSER_PER_PURCHASE_LIMIT_ERROR")]}),s.removeClass("isloading"),void e("#ticketsTypes").chosen();e(".ticketInput"+n).val(++r),e("#coupon_troption").show(),JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"order.addItem",orderId:parseInt(t.data("order-id")),typeId:n,view:"order"}}).done((function(t){!0===t.success?(s.empty(),s.html(t.data)):(e(".ticketInput"+n).val(Math.max(0,r-1)),Joomla.renderMessages({error:[t.message]}))})).fail((function(t){e(".ticketInput"+n).val(Math.max(0,r-1)),Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]})})).always((function(){s.removeClass("isloading"),e("#ticketsTypes").chosen()}))})),e(document).on("click",".removeCoupon",(function(){var t=e(".js-jt-ticket-listing");t.addClass("isloading");var o=e(this),a=e("#coupon_code").val();JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"order.removeCoupon",couponCode:a,orderId:parseInt(o.data("order-id")),view:"order"}}).done((function(e){!0===e.success?(t.empty(),t.html(e.data)):e.message&&Joomla.renderMessages({error:[e.message]})})).fail((function(e){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]})})).always((function(){t.removeClass("isloading"),e("#ticketsTypes").chosen(),e("#ticketsTypes").length&&t.trigger("subform-row-add",e(".js-jt-ticket-listing"))}))})),e(document).on("click",".applyCoupon",(function(){var t=e(".js-jt-ticket-listing");t.addClass("isloading");var o=e(this);if(""==e("#coupon_code").val())return alert(Joomla.JText._("ENTER_COP_COD")),t.removeClass("isloading"),void e("#ticketsTypes").chosen();t.addClass("isloading");var a=document.getElementById("coupon_code").value;JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"order.applyCoupon",couponCode:a,orderId:parseInt(o.data("order-id")),view:"order"}}).done((function(e){!1!==e.success?(t.empty(),t.html(e.data)):alert(a+" "+e.message)})).fail((function(e){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]})})).always((function(o){t.removeClass("isloading"),e("#ticketsTypes").chosen(),e("#ticketsTypes").length&&t.trigger("subform-row-add",e(".js-jt-ticket-listing"))}))})),e(document).on("click",".billingCheckout",(function(t){var o=document.billing_info_form,a=e(this),n=e("#accept_privacy_term").data("consent"),r=e("#billingCheckout"),s=/^[a-zA-Z\s-]+$/,i=e(".regexForAttendeeMob").val();if(i=new RegExp(i),!document.formvalidator.isValid(o)){var d="";return n&&!1===document.getElementById("accept_privacy_term").checked&&(d=Joomla.JText._("COM_JTICKETING_PRIVACY_TERMS_AND_CONDITIONS_ERROR"),Joomla.renderMessages({error:[d]})),e("html, body").animate({scrollTop:0},"slow"),t.preventDefault()}if(jQuery("#fname").length&&jQuery("#fname").length&&""!=jQuery("#fname").val()&&!s.test(jQuery("#fname").val())){var l=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_INVALID_BILLING_FNAME");return Joomla.renderMessages({error:[l]}),jQuery("html, body").animate({scrollTop:0},"slow"),!1}if(jQuery("#lname").length&&jQuery("#lname").length&&""!=jQuery("#lname").val()&&!s.test(jQuery("#lname").val())){l=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_INVALID_BILLING_LNAME");return Joomla.renderMessages({error:[l]}),jQuery("html, body").animate({scrollTop:0},"slow"),!1}if(jQuery("#phone").length&&jQuery("#phone").length&&""!=jQuery("#phone").val()&&!i.test(jQuery("#phone").val())){l=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_INVALID_BILLING_MOB");return Joomla.renderMessages({error:[l]}),jQuery("html, body").animate({scrollTop:0},"slow"),!1}e(".alert-error").hide();var c=e("#billing_info_form").serialize(),m=parseInt(a.data("order-id"));JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"order.addBillingData",billingValues:c,orderId:parseInt(a.data("order-id")),checkout_method:e('input[name="account_jt"]:checked').val()},beforeSend:function(){r.attr("disabled",!0),r.addClass("btn-loading")}}).done((function(t){if(r.attr("disabled",!1),!0===t.success){if(1===ga_ec_analytics){var o=3;1===track_attendee_step&&(o=4),jtSite.order.addEcTrackingData(m,o)}document.location=t.data}else Joomla.renderMessages({error:[t.message]}),e("html, body").animate({scrollTop:0},"slow");r.removeClass("btn-loading")})).fail((function(t){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]}),e("html, body").animate({scrollTop:0},"slow")}))})),e(document).on("click",".orderLogin",(function(){var t=e(this),o=e("#button-login");JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"order.loginValidate",email:e("#loginEmail").val(),password:e("#loginPassword").val(),orderId:t.data("order-id")},beforeSend:function(){o.attr("disabled",!0),o.addClass("btn-loading")}}).done((function(t){o.attr("disabled",!1),!1===t.success?(Joomla.renderMessages({error:[t.message]}),e("html, body").animate({scrollTop:0},"slow")):window.parent.location=t.data,o.removeClass("btn-loading")}))})),e(document).on("blur","#email1",(function(){var t=e("#email1"),o=t.val();if(t.data("user-id")>0)return!0;JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&view=order&task=order.checkUserEmailId&email="+o,type:"GET"}).done((function(t){!0===t.success?(e("#billing_info_data").show(),e("#btnWizardNext").removeAttr("disabled"),e("#btnWizardNext").show()):(e("#user_info").show(),e("#btnWizardNext").hide(),Joomla.renderMessages({error:[t.message]}),e("html, body").animate({scrollTop:0},"slow"))})).fail((function(){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]}),e("html, body").animate({scrollTop:0},"slow")}))}))}(JTQuery);