/*
 * @version    SVN:<SVN_ID>
 * @package    com_tjlms
 * @author     Techjoomla <extensions@techjoomla.com>
 * @copyright  Copyright (c) 2009-2015 TechJoomla. All rights reserved
 * @license    GNU General Public License version 2, or later
 */ if(void 0===tjrContentUI)var tjrContentUI={};tjrContentUI.root_url="undefined"==typeof root_url?"":root_url,tjrContentUI.base_url="undefined"==typeof root_url?"":root_url,tjrContentUI.report=tjrContentUI.report?tjrContentUI.report:{},jQuery.extend(tjrContentUI.report,{searchToggle:!0,$form:null,url:"index.php?option=com_tjreports&view=reports&format=json",querySaveUrl:"index.php?option=com_tjreports&format=json",submitTJRData:function(t){var e="default";"summary"==(t=void 0===t?"default":t)?(e="summary",jQuery("#summaryReportLabel").addClass("btn-danger"),jQuery("#detailsReportLabel").removeClass("btn-success"),jQuery("#reportPagination").hide(),jQuery("#pagination").hide()):(jQuery("#detailsReportLabel").removeClass("btn-success"),jQuery("#summaryReportLabel").removeClass("btn-danger"),jQuery("#reportPagination").show(),jQuery("#pagination").show());try{jQuery("#reports-container .hasTooltip").tooltip("destroy")}catch(o){jQuery("#reports-container .hasTooltip").tooltip("dispose")}if(this.searchToggle=jQuery("div#topFilters").is(":visible"),tjrContentUI.utility.loadingLayer("show"),this.$form=jQuery("#adminForm"),!this.validate())return!1;try{jQuery(".hasPopover").popover("destroy")}catch(n){jQuery(".hasPopover").popover("dispose")}tjrContentService.postData(this.url+"&tmpl="+e,this.$form.serialize()).fail(function(t){console.log("Something went wrong."),tjrContentUI.utility.loadingLayer("hide"),403==t.status&&alert(Joomla.JText._("JERROR_ALERTNOAUTHOR"))}).done(function(o){if(tjrContentUI.utility.loadingLayer("hide"),"summary"==e)jQuery("#report-containing-div").html(o.html);else{var n="#j-main-container",r=jQuery(o.html).find(n).html();jQuery(n).html(r),"undefined"!=typeof tjutilitysendemail&&jQuery("body").find(".td-sendemail").length>0&&tjutilitysendemail.addColumn("report-table"),jQuery(".hasPopover").popover({html:!0,trigger:"hover focus",container:"body"}),"showHide"==t&&tjrContentUI.report.getColNames();var a=jQuery(n+" .field-calendar");for(i=0;i<a.length;i++)JoomlaCalendar.init(a[i]);jQuery.prototype.chosen&&jQuery(n+" select").chosen(),"reset"==t&&(tjrContentUI.report.searchToggle=!1),tjrContentUI.report.searchToggle&&(jQuery("#show-filter").addClass("btn-primary").find("i").removeClass("fa-caret-down").addClass("fa-caret-up"),jQuery("#topFilters").show()),jQuery(".btn-displayReport").toggleClass("active btn-success")}}).always(function(t){jQuery(".filter-hide").parents(".col-filter-header").hide(),jQuery(".filter-show").parents("th").find(".table-heading").hide()})},showFilter:function(){jQuery("#show-filter").toggleClass("btn-primary"),jQuery("#topFilters").slideToggle("1000"),jQuery("#show-filter .fa").toggleClass("fa-caret-up").toggleClass("fa-caret-down")},resetSubmitTJRData:function(t,e){jQuery("input:text",e=e&&e.length?e:"#topFilters").val(""),jQuery(":input",e).not(":button, :submit, :reset, input:hidden").val("").removeAttr("checked").removeAttr("selected"),tjrContentUI.report.submitTJRData(t)},validate:function(){return!0},getColNames:function(){jQuery(".ColVis_collection").toggle()},cancel:function(){jQuery("#btn-cancel").hide(),jQuery(".saveData").html("Want to save this?"),jQuery('#adminForm1 input[type="text"]').val(""),jQuery(".cancel-btn").hide(),jQuery("#queryName").val("")},saveThisQuery:function(){this.$form=jQuery("#adminForm");var t=jQuery("#queryName").is(":hidden");if(jQuery("#btn-cancel").show(),jQuery(".cancel-btn").show(),jQuery("input").css("margin-bottom","0px"),1==t)jQuery("#queryName").show(),jQuery("#saveQuery").html(Joomla.JText._("COM_TJREPORTS_SAVE_QUERY"));else{var e=jQuery("#queryName").val();if(""===e)return alert(Joomla.JText._("COM_TJREPORTS_ENTER_TITLE")),!1;jQuery("#task",this.$form).val("reports.saveQuery");var o=this.$form.serialize();jQuery("#task",this.$form).val(""),tjrContentUI.utility.loadingLayer(),tjrContentService.postData(this.querySaveUrl+"&queryName="+e,o).fail(function(t){console.log("Something went wrong."),tjrContentUI.utility.loadingLayer("hide")}).done(function(t){tjrContentUI.utility.loadingLayer("hide"),t.success?window.location.reload():console.log("Something went wrong.",t.message,t.messages)})}},deleteThisQuery:function(){this.$form=jQuery("#adminForm"),jQuery("#queryName").is(":hidden");var t=jQuery("#queryId").val();if(""===t)return alert("Select Any of the query"),!1;if(confirm(deletemsg=Joomla.JText._("COM_TJREPORTS_DELETE_MESSAGE"))){jQuery("#task",this.$form).val("reports.deleteQuery");var e=this.$form.serialize();tjrContentUI.utility.loadingLayer(),tjrContentService.postData(this.querySaveUrl+"&queryId="+t,e).fail(function(t){console.log("Something went wrong."),tjrContentUI.utility.loadingLayer("hide")}).done(function(t){tjrContentUI.utility.loadingLayer("hide"),t.success?(tjrContentUI.utility.setJSCookie("showdeletemsg","1",1),window.location.reload()):console.log("Something went wrong.",t.message,t.messages)})}},getQueryResult:function(t){var e=tjrContentUI.base_url+"index.php?option=com_tjreports&view=reports";jQuery.each({client:"client",reportId:"reportId",queryId:"queryId"},function(t,o){var n=jQuery("#"+t).val();n&&(e+="&"+o+"="+n)}),window.location.href=e},submitForm:function(){return!!jQuery("#task").val()||(tjrContentUI.report.submitTJRData("submit"),!1)},loadReport:function(t,e){jQuery(t).val();var o=jQuery(t).find(":selected").attr("data-reportid"),n=jQuery(document.adminForm).attr("action")+"&reportId="+o;jQuery("#report-select options").attr("selected","selected"),e&&(n=n+"&client="+e),window.location.href=n},submitOnEnter:function(t){return"keydown"==t.type&&(13==t.which||13==t.keyCode)&&tjrContentUI.report.submitTJRData(),!1},attachCalSubmit:function(t){var e=JoomlaCalendar.getCalObject(t);e&&!e._joomlaCalendar.params.onUpdate&&(e._joomlaCalendar.params.onUpdate=tjrContentUI.report.submitCalForm)},submitCalForm:function(){tjrContentUI.report.submitTJRData()}}),tjrContentUI.validation=tjrContentUI.validation?tjrContentUI.validation:{},jQuery.extend(tjrContentUI.validation,{messages:{},resetInvalidField:function(t,e,o){t&&t.val(""),this.addMessage(e,o)},addMessage:function(t,e){e=e||"error",this.messages[e]=this.messages[e]?this.messages[e]:[],this.messages[e].push(t)},resetMessages:function(){Joomla.removeMessages(),this.messages={}},isValidDate:function(t){return null!=(t=t.split(" "))[0].match(/^\d{4}[-](0?[1-9]|1[012])[-](0?[1-9]|[12][0-9]|3[01])$/)},isValidCalDate:function(t,e){return void 0===Date.parseDate?this.isValidDate(date):(e||(e="%d-%m-%Y"),Date.parseDate(t,e).print(e)==t||void 0)}}),tjrContentUI.utility=tjrContentUI.utility?tjrContentUI.utility:{},jQuery.extend(tjrContentUI.utility,{getTimeStampFromDate:function(t,e){if(void 0!==Date.parseDate){e||(e="%d-%m-%Y");var o=Date.parseDate(t,e);if(o)return o.getTime()}return t},loadingLayer:function(t,e){if(t=t||"show",e=e||document.body,"load"==t){var o=document.createElement("div");o.id="loading-logo",o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100%",o.style.opacity="0.8",o.style.filter="alpha(opacity=80)",o.style.overflow="hidden",o.style["z-index"]="10000",o.style.display="none",o.style["background-color"]="#fff",o.style["background-image"]='url("'+tjrContentUI.root_url+'/components/com_tjreports/assets/images/loadinfo.gif")',o.style["background-position"]="center",o.style["background-repeat"]="no-repeat",o.style["background-attachment"]="fixed",o.style["background-size"]="200px",e.appendChild(o)}else document.getElementById("loading-logo")||this.loadingLayer("load",e),document.getElementById("loading-logo").style.display="show"==t?"block":"none";return document.getElementById("loading-logo")},noScript:function(t){var e=jQuery("<div>").html(t);return e.find("script").remove(),t=e.html()},displayMessage:function(t,e,o){this.parent.validation.messages={},this.parent.validation.addMessage(t,e),this.displayMessages()},displayMessages:function(t){Joomla.removeMessages(),Joomla.renderMessages(this.parent.validation.messages),t&&jQuery("body").animate({scrollTop:jQuery("#system-message-container").offset().top},500)},setJSCookie:function(t,e,o){var n="";if(o){var r=new Date;r.setTime(r.getTime()+864e5*o),n="; expires="+r.toUTCString()}document.cookie=t+"="+e+n+"; path=/"},getJSCookie:function(t){for(var e=t+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var r=o[n];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(e))return r.substring(e.length,r.length)}return null},eraseJSCookie:function(t){tjrContentUI.utility.setJSCookie(t,"",-1)}}),tjrContentUI.tjreport=tjrContentUI.tjreport?tjrContentUI.tjreport:{},jQuery.extend(tjrContentUI.tjreport,{getPlugins:function(){var t=jQuery("#adminForm.tjreportForm");jQuery("#task",t).val("tjreport.getplugins");var e=tjrContentService.postData("index.php?option=com_tjreports&format=json",t.serialize());jQuery("#task",t).val(),jQuery("#jform_parent",t).find("option").not(":first").remove(),e.fail(function(t){console.log("Something went wrong."),403==t.status&&alert(Joomla.JText._("JERROR_ALERTNOAUTHOR"))}).done(function(t){if(t.success){var e=jQuery("#jform_parent");jQuery.each(t.data,function(t,o){e.append(new Option(o.text,o.value))}),tjrContentUI.tjreport.getParams()}else console.log("Something went wrong.",t.message,t.messages)})},loadSort:function(){jQuery(".col-filter-header").hide(),jQuery(document).on("click",".col-search",function(){var t=jQuery(this).parents("th");jQuery(".col-filter-header",t).show(),jQuery(".chzn-search").children("input").attr("readOnly",!1),jQuery(".table-heading",t).hide()}),jQuery(document).on("click",".close-icon",function(){var t=jQuery(this).parents("th");jQuery(".table-heading",t).show(),jQuery(".col-filter-header",t).hide(),tjrContentUI.report.resetSubmitTJRData("submit",t)})},getParams:function(t){var e="index.php?option=com_tjreports&format=json";t&&(e+="&default=1");var o=jQuery("#adminForm.tjreportForm");jQuery("#task",o).val("tjreport.getparams");var n=tjrContentService.postData(e,o.serialize());jQuery("#task",o).val(),jQuery("#jform_param",o).val(""),jQuery("#jform_plugin",o).val(""),n.fail(function(t){console.log("Something went wrong."),403==t.status&&alert(Joomla.JText._("JERROR_ALERTNOAUTHOR"))}).done(function(t){if(t.success){var e=JSON.stringify(JSON.parse(t.data.param),null,"	");jQuery("#jform_param",o).val(e),jQuery("#jform_plugin",o).val(t.data.plugin)}else console.log("Something went wrong.",t.message,t.messages)})}}),jQuery(document).click(function(t){jQuery(t.target).closest("#ul-columns-name").length||"show-hide-cols-btn"==t.target.id||jQuery(".ColVis_collection").hide()}),jQuery(document).ready(function(){jQuery("#topFilters").hide(),jQuery("#btn-cancel").hide(),jQuery(".cancel-btn").hide(),tjrContentUI.tjreport.loadSort(),tjrContentUI.utility.getJSCookie("showdeletemsg")&&(Joomla.JText.strings.SUCCESS||(Joomla.JText.strings.SUCCESS="Success"),Joomla.renderMessages({success:[Joomla.JText._("COM_TJREPORTS_QUERY_DELETE_SUCCESS")]}),tjrContentUI.utility.eraseJSCookie("showdeletemsg")),jQuery(document).on("click",'#reports-container a[href="#"]',function(t){t.preventDefault()})}),jQuery(document).ready(function(){jQuery("#report-table").on("liszt:ready","select",function(){jQuery(this).next(".chzn-container-single-nosearch").removeClass("chzn-container-single-nosearch")})});